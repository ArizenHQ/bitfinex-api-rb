#!/usr/bin/env ruby -Ilib

require 'bitfinexrb'
require 'awesome_print'

@ws = Bitfinexrb::Websocket::EMClient.new

EVENTS = [:open, :auth_success, :position_status, :order_status, :wallet_status, :book_snapshot,
          :book_update, :subscribe, :auth_failed, :order_new, :order_update, :order_close, :trade_execute,
          :wallet_update, :position_create, :position_update, :position_close
         ]

EVENTS.each do |evt|
  @ws.on(evt) do |msg|
    ap [evt, msg]
    if evt == :open
      @ws.authenticate
    elsif evt == :auth_success
      # @ws.send({Event: 'subscribe', Pair: 'BTCUSD', Channel: 'book', Prec: 'P0', Len: 'full'})
    end
  end
end

@ws.run!
